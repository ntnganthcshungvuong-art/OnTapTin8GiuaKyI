<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>√în t·∫≠p gi·ªØa k√¨ I ‚Äì Tin h·ªçc 8 (KNTT)</title>
  <style>
    :root{
      --bg:#f6f9fc; --card:#fff; --ink:#0f172a; --muted:#475569;
      --sky:#0ea5e9; --sky-100:#e0f2fe; --green:#10b981; --red:#ef4444;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);font:16px/1.6 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;}
    .container{max-width:980px;margin:32px auto;padding:0 16px}
    h1{margin:8px 0 6px;color:var(--ink);font-weight:800}
    .sub{color:var(--muted);margin-bottom:12px}
    .toolbar{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0 18px}
    .btn{border:0;border-radius:10px;padding:10px 14px;background:var(--sky-100);color:#0c4a6e;cursor:pointer}
    .btn:hover{filter:brightness(0.98)}
    .btn.primary{background:var(--sky);color:#fff}
    .card{background:var(--card);border-radius:14px;padding:18px;margin:14px 0;box-shadow:0 2px 10px rgba(2,8,23,.06)}
    .q-title{font-weight:700;margin-bottom:10px}
    .q-img{max-width:100%;height:auto;display:block;margin:10px 0}
    .opt{display:flex;gap:8px;align-items:flex-start;margin:6px 0;padding:8px;border-radius:10px;transition:.15s}
    .opt:hover{background:#f1f5f9}
    .muted{color:var(--muted)}
    .hint{display:none;margin-top:8px;padding:10px;border-radius:10px;background:#f8fafc;border:1px dashed #cbd5e1}
    .hint.show{display:block}
    .pill{display:inline-flex;align-items:center;gap:6px;font-size:13px;border-radius:999px;padding:4px 10px;background:#eef2ff;color:#3730a3}
    .score{font-weight:800}
    .footer-note{margin-top:22px;color:var(--muted);font-size:13px}
    .essay-box{width:100%;min-height:110px;border:1px solid #e2e8f0;border-radius:10px;padding:10px}
    .good{color:var(--green)} .bad{color:var(--red)}
    .hr{height:1px;background:#e2e8f0;margin:18px 0}
  </style>
</head>
<body>
  <div class="container">
    <h1>√în t·∫≠p Gi·ªØa K√¨ I ‚Äì Tin h·ªçc 8</h1>
    <div class="sub">Theo SGK <b>K·∫øt n·ªëi tri th·ª©c v·ªõi cu·ªôc s·ªëng</b>. C√≥ 30 c√¢u tr·∫Øc nghi·ªám + 2 c√¢u t·ª± lu·∫≠n, h·ªó tr·ª£ g·ª£i √Ω &amp; l√†m l·∫°i.</div>

    <div class="toolbar">
      <button id="btnRetryNoShuffle" class="btn">üîÅ L√†m l·∫°i (gi·ªØ th·ª© t·ª±)</button>
      <button id="btnRetryShuffle" class="btn">üé≤ L√†m l·∫°i (x√°o c√¢u &amp; ƒë√°p √°n)</button>
      <button id="btnGrade" class="btn primary">‚úÖ Ch·∫•m ƒëi·ªÉm tr·∫Øc nghi·ªám</button>
      <span id="score" class="pill">ƒêi·ªÉm: <span class="score">0/0</span></span>
    </div>

    <div id="quiz"></div>

    <div class="footer-note">M·∫πo: ƒë·ªçc kƒ© c√¢u h·ªèi, soi ‚Äút·ª´ kh√≥a‚Äù ƒë√∫ng ‚Äì <i>si√™u nƒÉng l·ª±c h·ªçc sinh th·ªùi s·ªë</i> l√† bi·∫øt ho√†i nghi c√≥ ph∆∞∆°ng ph√°p.</div>
  </div>

  <script>
  let ORIGINAL_DATA = null;

  // Fisher‚ÄìYates
  function shuffleArray(a){
    for(let i=a.length-1;i>0;i--){
      const j=Math.floor(Math.random()*(i+1));
      [a[i],a[j]]=[a[j],a[i]];
    }
  }
  const clone = o => JSON.parse(JSON.stringify(o));

  function shuffleOptions(q){
    const pairs = q.options.map((t,i)=>({t,i}));
    shuffleArray(pairs);
    q.options = pairs.map(p=>p.t);
    q.answer = pairs.findIndex(p=>p.i===q.answer);
  }

  async function loadData(){
    const res = await fetch('data/tin8.json');
    ORIGINAL_DATA = await res.json();
    render(ORIGINAL_DATA, false);
  }

  function render(raw, doShuffle){
    const data = clone(raw);
    if(doShuffle){
      shuffleArray(data.mcqs);
      data.mcqs.forEach(shuffleOptions);
    }
    buildQuiz(data);
  }

  function buildQuiz(data){
    const root = document.getElementById('quiz');
    root.innerHTML = '';

    // --- Ph·∫ßn TR·∫ÆC NGHI·ªÜM ---
    const mcWrap = document.createElement('div');
    mcWrap.innerHTML = `<div class="card"><div class="q-title">PH·∫¶N TR·∫ÆC NGHI·ªÜM</div>
                        <div class="muted">Ch·ªçn 1 ƒë√°p √°n ƒë√∫ng cho m·ªói c√¢u.</div></div>`;
    root.appendChild(mcWrap.firstChild);

    data.mcqs.forEach((q, idx)=>{
      const card = document.createElement('div');
      card.className = 'card';
      const qid = `q${idx}`;

      card.innerHTML = `
        <div class="q-title">C√¢u ${idx+1}: ${q.stem}</div>
        ${q.img ? `<img class="q-img" src="${q.img}" alt="minh h·ªça">` : ``}
        <div>${q.options.map((opt,oi)=>`
          <label class="opt">
            <input type="radio" name="${qid}" value="${oi}"/>
            <span>${String.fromCharCode(65+oi)}. ${opt}</span>
          </label>`).join('')}</div>
        <div class="toolbar" style="margin-top:8px">
          <button class="btn hint-btn">G·ª£i √Ω</button>
        </div>
        <div class="hint">${q.hint || 'H√£y suy lu·∫≠n d·ª±a tr√™n kh√°i ni·ªám trong b√†i h·ªçc.'}</div>
      `;
      root.appendChild(card);
      card.querySelector('.hint-btn').addEventListener('click', ()=>{
        card.querySelector('.hint').classList.toggle('show');
      });
    });

    // --- Ph·∫ßn T·ª∞ LU·∫¨N ---
    const es = document.createElement('div');
    es.innerHTML = `<div class="card"><div class="q-title">PH·∫¶N T·ª∞ LU·∫¨N</div>
                    <div class="muted">Tr·∫£ l·ªùi ng·∫Øn g·ªçn, n√™u r√µ lu·∫≠n ƒëi·ªÉm &amp; v√≠ d·ª•.</div></div>`;
    root.appendChild(es.firstChild);

    data.essay.forEach((e, i)=>{
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <div class="q-title">${e.title}</div>
        <div class="muted" style="white-space:pre-line">${e.prompt}</div>
        <textarea class="essay-box" placeholder="Nh·∫≠p c√¢u tr·∫£ l·ªùi c·ªßa em..."></textarea>
        <div class="hr"></div>
        <details>
          <summary class="muted">G·ª£i √Ω ch·∫•m/√Ω ch√≠nh</summary>
          <div class="hint show" style="display:block">${e.rubric}</div>
        </details>
      `;
      root.appendChild(card);
    });

    // C·∫≠p nh·∫≠t t·ªïng s·ªë c√¢u
    const scoreTag = document.querySelector('#score .score');
    scoreTag.textContent = `0/${data.mcqs.length}`;
  }

  function grade(){
    const cards = [...document.querySelectorAll('#quiz .card')];
    let iQ = 0, correct = 0, total = 0;

    cards.forEach(card=>{
      const title = card.querySelector('.q-title');
      if(!title || !title.textContent.trim().startsWith('C√¢u ')) return;

      const name = 'q'+iQ;
      const picked = card.querySelector(`input[name="${name}"]:checked`);
      const ansIndex = window.__DATA_CURRENT?.mcqs?.[iQ]?.answer ?? null;

      if(ansIndex!==null){
        total++;
        if(picked && +picked.value === +ansIndex){
          correct++;
          title.innerHTML = title.innerHTML.replace(/$/, ` <span class="good">‚úî ƒê√∫ng</span>`);
        }else{
          title.innerHTML = title.innerHTML.replace(/$/, ` <span class="bad">‚úò Sai</span>`);
        }
      }
      iQ++;
    });

    const scoreTag = document.querySelector('#score .score');
    scoreTag.textContent = `${correct}/${total}`;
  }

  // expose current data to grade()
  function setCurrentData(d){ window.__DATA_CURRENT = d; }

  // Hook buttons
  window.addEventListener('DOMContentLoaded', ()=>{
    document.getElementById('btnRetryNoShuffle').addEventListener('click', ()=>render(ORIGINAL_DATA,false));
    document.getElementById('btnRetryShuffle').addEventListener('click', ()=>render(ORIGINAL_DATA,true));
    document.getElementById('btnGrade').addEventListener('click', grade);
    loadData().then(()=> setCurrentData(ORIGINAL_DATA));
  });
  </script>
</body>
</html>

